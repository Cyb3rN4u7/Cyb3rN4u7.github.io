<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Angular Testing with Jasmine</title><meta name="keywords" content="web development, achilles moraites,angular,javascript,typescript,testing" data-svelte="svelte-1k0b6ih"><meta name="description" content="When testing our apps there are times when we need to control things that are beyond our control, like the window object" data-svelte="svelte-1k0b6ih"><meta name="author" content="Achilles Moraites" data-svelte="svelte-1k0b6ih"><meta property="og:image" content="https://images.pexels.com/photos/5726788/pexels-photo-5726788.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=255&amp;w=400" data-svelte="svelte-1k0b6ih"><meta property="og:description" content="When testing our apps there are times when we need to control things that are beyond our control, like the window object" data-svelte="svelte-1k0b6ih"><meta property="og:title" content="Angular Testing with Jasmine" data-svelte="svelte-1k0b6ih"><meta property="og:type" content="article" data-svelte="svelte-1k0b6ih"><meta property="og:url" data-svelte="svelte-1k0b6ih"><meta property="og:article:author" content="Achilles Moraites" data-svelte="svelte-1k0b6ih">
		<meta property="og:article:tag" content="angular,javascript,typescript,testing" data-svelte="svelte-1k0b6ih">
		<meta property="og:article:published_time" content="Fri May 08 2020 00:00:00 GMT+0300" data-svelte="svelte-1k0b6ih"><meta name="twitter:card" content="summary" data-svelte="svelte-1k0b6ih"><meta name="twitter:site" content="@achimoraites" data-svelte="svelte-1k0b6ih"><meta name="twitter:creator" content="@achimoraites" data-svelte="svelte-1k0b6ih"><meta name="twitter:image" content="https://images.pexels.com/photos/5726788/pexels-photo-5726788.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=255&amp;w=400" data-svelte="svelte-1k0b6ih">

		

		<link rel="modulepreload" href="/./app/start-072906a6.js">
		<link rel="modulepreload" href="/./app/chunks/vendor-4d2c4da8.js">
		<link rel="modulepreload" href="/./app/pages/blog/$layout.reset.svelte-2b217d8f.js">
		<link rel="modulepreload" href="/./app/chunks/TopNav-f74f91dd.js">
		<link rel="modulepreload" href="/./app/pages/blog/advanced-angular-testing-using-jasmine.md-72fbd372.js">
		<link rel="modulepreload" href="/./app/chunks/blog-post-layout-56840a44.js">
		<link rel="modulepreload" href="/./app/chunks/OpenGraph-a53e9ebf.js">
		<link rel="modulepreload" href="/./app/chunks/Tags-bf290eaa.js">
		<link rel="stylesheet" href="/./app/assets/start-0826e215.css">
		<link rel="stylesheet" href="/./app/assets/pages/blog/$layout.reset.svelte-ae38d9e4.css">

		<script type="module">
			import { start } from "/./app/start-072906a6.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: (function(a,b,c,d,e,f,g,h){return {posts:[{author:a,date:"Sun May 10 2020 00:00:00 GMT+0300",excerpt:"Crafting high quality Angular apps requires to have knowledge of how to use the different types of modules to ensure readability, performance and scalability.",tags:[b,c,d],image:"https:\u002F\u002Fimages.pexels.com\u002Fphotos\u002F171198\u002Fpexels-photo-171198.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=225&w=400",slug:"angular-types-of-modules",subtitle:"Improve the scalabillity of your Angular project by using the module type pattern!",title:"Types of Modules in Angular",url:"https:\u002F\u002Fachimoraites.github.io\u002Fblog\u002Fangular-types-of-modules",uri:"\u002Fblog\u002Fangular-types-of-modules",filename:"angular-types-of-modules.md"},{author:a,date:e,excerpt:"When testing our apps there are times when we need to control things that are beyond our control, like the window object",image:"https:\u002F\u002Fimages.pexels.com\u002Fphotos\u002F5726788\u002Fpexels-photo-5726788.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=255&w=400",tags:[c,d,b,"testing"],slug:"advanced-angular-testing-using-jasmine",subtitle:f,title:"Angular Testing with Jasmine",url:"https:\u002F\u002Fachimoraites.github.io\u002Fblog\u002Fadvanced-angular-testing-using-jasmine",uri:"\u002Fblog\u002Fadvanced-angular-testing-using-jasmine",filename:"advanced-angular-testing-using-jasmine.md"},{author:a,date:e,excerpt:"Component inheritance can be useful when you have duplicated\u002Fshared code between your components.",tags:[b,c,g,d],slug:"angular-component-inheritance",subtitle:f,title:"Angular Component inheritance",url:"https:\u002F\u002Fachimoraites.github.io\u002Fblog\u002Fangular-component-inheritance",uri:"\u002Fblog\u002Fangular-component-inheritance",filename:"angular-component-inheritance.md"},{author:a,date:"Wed Jan 29 2020 00:00:00 GMT+0200",excerpt:h,image:"https:\u002F\u002Fimages.pexels.com\u002Fphotos\u002F1701206\u002Fpexels-photo-1701206.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=225&w=400",tags:[b,g,"productivity"],slug:"typescript-tips-and-tricks",subtitle:h,title:"Typescript Tips and Tricks",url:"https:\u002F\u002Fachimoraites.github.io\u002Fblog\u002Ftypescript-tips-and-tricks",uri:"\u002Fblog\u002Ftypescript-tips-and-tricks",filename:"typescript-tips-and-tricks.md"}]}}("achimoraites","typescript","angular","javascript","Fri May 08 2020 00:00:00 GMT+0300","Improve the scalabillity of your Angular project by using inheritance!","oop","Here are two Typescript tricks to make your life as a software developer easier.")),
				host: location.host,
				route: true,
				spa: false,
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./app/pages/blog/$layout.reset.svelte-2b217d8f.js"),
						import("/./app/pages/blog/advanced-angular-testing-using-jasmine.md-72fbd372.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/blog/advanced-angular-testing-using-jasmine",
						query: new URLSearchParams(""),
						params: {}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<nav class="header top-nav"><div class="header__container"><div class="brand"><a class="brand__link" href="/blog">Achilles Moraites</a></div>

<div class="burger-menu"><button id="nav-toggle" class="burger-menu__button"><svg width="12" height="12" class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div>

<div class="navlinks hidden-bar" id="nav-content"><ul class="navlinks__list list-reset"><li class="navlinks__list-element"><a class="navlinks__default" href="/"><span>Home</span></a>
			</li><li class="navlinks__list-element"><a class="navlinks__active" href="/blog"><span>Blog</span></a>
			</li></ul></div></div></nav>
<main style="margin-top: 3rem;">

<article class="blog-post"><h1 style="font-size: 3rem;">Angular Testing with Jasmine</h1>
	<div class="tags"><div class="article-tags"><a href="/blog"><span class="angular">#angular</span></a><a href="/blog"><span class="javascript">#javascript</span></a><a href="/blog"><span class="typescript">#typescript</span></a><a href="/blog"><span class="testing">#testing</span></a></div></div>
	<p class="author">By <span style="font-weight: 600">achimoraites</span> <span>May 7, 2020</span></p>
	<p>When testing our apps there are times when we need to control things that are beyond our control, like the window object.
One common scenario is when we need to test our code against browser specific APIs.</p>
<blockquote><p>If you are looking how to upgrade your testing skills this is the article you have been looking for!</p></blockquote>
<h2>Show me the code</h2>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// history.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  selector<span class="token operator">:</span> <span class="token string">'app-history'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./history.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./history.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HistoryComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'length 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// IE</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>msSaveOrOpenBlob<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span><span class="token function">msSaveOrOpenBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'custom handling'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span></code></pre>
<h3>Now lets test the <code>goBack()</code> method</h3>
<p>As you know already the <code>window.history</code> is read only.
We need to test two cases:</p>
<ul><li>history.length == 1</li>
<li>history.length &gt; 1</li></ul>
<p>in our history.component.spec.ts
we use the <code>spyOnProperty</code> to mock the <code>window.history.length</code> to be able to test our both cases:</p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should execute "goBack" as expected when history === 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// spy on console.log()</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// here we mock the history length to be 1</span>
    <span class="token function">spyOnProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>history<span class="token punctuation">,</span> <span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'length 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should execute "goBack" as expected when history > 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// spy on window.history.back()</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>history<span class="token punctuation">,</span> <span class="token string">'back'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// here we mock the history length to be 2</span>
    <span class="token function">spyOnProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>history<span class="token punctuation">,</span> <span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>back<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>that was easy :)</p>
<p>Now lets tackle a more interesting case, what about testing a browser specific api?</p>
<h3>Testing browser specific APIs</h3>
<p>Now in the <code>saveFile()</code> method we are using a browser specific API, here things are getting more interesting.</p>
<p>The <code>window.navigator.msSaveOrOpenBlob</code> is available only on IE,
on other supported browsers we have a different implementation.</p>
<p>Let’s dive to our test code!</p>
<pre class="language-typescript"><code class="language-typescript"> <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should execute "saveFile" as expected on IE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// create a mock navigator</span>
    <span class="token keyword">const</span> mockNavigator <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'msSaveOrOpenBlob'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// here we use the mockNavigator to simulate IE</span>
    <span class="token function">spyOnProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'navigator'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span>mockNavigator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// verify that method has been called :)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockNavigator<span class="token punctuation">.</span>msSaveOrOpenBlob<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should execute "saveFile" as expected on browsers other than IE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// spy on console.log()</span>
    <span class="token function">spyOn</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// create a mock navigator</span>
    <span class="token keyword">const</span> mockNavigator <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// here we use the mockNavigator to simulate behavior</span>
    <span class="token function">spyOnProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'navigator'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span>mockNavigator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// verify that method has been called :)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'custom handling'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Here we mocked the <code>window.navigator</code> to be able to simulate the behavior on both cases!</p>
<h2>Summary</h2>
<p>Today we learned about mocking the window object to be able to do tests against browser specific APIs.
By using this technique you will be able to mock anything you need to test your code.</p>
<p>I hope you enjoyed it,
Happy coding :)</p>
<h3>Credits</h3>
<p>Photo by <a href="https://www.pexels.com/@artempodrez?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels" rel="nofollow">Artem Podrez</a>  from <a href="https://www.pexels.com/photo/a-woman-doing-an-experiment-5726788/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels" rel="nofollow">Pexels</a></p></article></main>

<footer class="bg-gray-900 mt-5"><hr class="border-1 border-gray-600 w-full">

<p class="text-gray-400 py-2 text-xs text-center">© 2021 <b><a rel="noopener noreferrer" target="_blank" href="https://achimoraites.github.io">Achilles Moraites</a></b></p></footer>



	
</div>
	</body>
</html>
